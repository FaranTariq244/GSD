#progress Log

## Learnings
- Database: PostgreSQL with pg client library
- Migration pattern: Custom SQL migration runner in src/migrate.ts
- Database connection: Pool exported as default from src/db.ts, configured via environment variables
- Migration files stored in packages/backend/migrations/ as .sql files
- Run migrations with: npm run migrate (in backend package)
- Database config: .env.example provides template for DB_HOST, DB_PORT, DB_NAME, DB_USER, DB_PASSWORD
- Authentication: JWT tokens stored in httpOnly cookies (7 day expiration)
- Auth middleware: authenticate function in src/middleware/auth.ts adds userId to request
- Password hashing: bcryptjs with salt rounds = 10
- JWT_SECRET: Required in .env for production, defaults to dev-secret in development

---

## Iteration 1 - Set up project structure
- Created monorepo using npm workspaces with packages/backend and packages/frontend
- Backend: Node.js + TypeScript + Express with basic health endpoint
- Frontend: Vite + React 19 + TypeScript (scaffolded with create-vite)
- Files changed:
  - Root: package.json (workspace config), .gitignore, README.md, PRD.md (added task checklist)
  - Backend: package.json, tsconfig.json, src/index.ts
  - Frontend: All Vite scaffolded files (updated package.json name to @gsd/frontend)
- Learnings for future iterations:
  - Project uses npm workspaces for monorepo structure
  - Backend runs on port 3000 by default
  - Frontend runs on port 5173 (Vite default)
  - Test command returns exit 0 for now (no tests yet)
  - Typecheck uses `tsc --noEmit` across both packages
  - PRD.md now has task checklist at the top (added in this iteration)
---

## Iteration 2 - Set up database schema and migrations
- Installed pg and @types/pg for PostgreSQL database client
- Created comprehensive database schema covering all tables from PRD data model
- Files changed:
  - packages/backend/package.json (added pg, node-pg-migrate, @types/pg, and migrate script)
  - packages/backend/migrations/1_initial_schema.sql (all 8 tables with indexes)
  - packages/backend/src/db.ts (pool connection with env config)
  - packages/backend/src/migrate.ts (custom migration runner)
  - packages/backend/.env.example (database and server config template)
- Learnings for future iterations:
  - Tables: users, accounts, account_members, boards, tasks, task_assignees, task_tags, comments, attachments
  - All tables follow PRD spec with proper foreign keys and cascade deletes
  - Migration runner tracks applied migrations in a migrations table
  - Migration runner uses transactions (BEGIN/COMMIT/ROLLBACK) for safety
  - Indexes added for common query patterns (board_id, column, task_id, user_id, tag)
  - Database can be initialized by running: npm run migrate (in backend package)
---

## Iteration 3 - Implement user signup/login authentication
- Installed bcryptjs, jsonwebtoken, and cookie-parser with type definitions
- Created authentication middleware (src/middleware/auth.ts) that validates JWT tokens from cookies
- Created auth routes (src/routes/auth.ts) with three endpoints:
  - POST /auth/signup: Creates user with hashed password, returns JWT in httpOnly cookie
  - POST /auth/login: Validates credentials, returns JWT in httpOnly cookie
  - POST /auth/logout: Clears authentication cookie
- Files changed:
  - packages/backend/package.json (added bcryptjs, jsonwebtoken, cookie-parser + types)
  - packages/backend/src/index.ts (added cookie-parser middleware and auth routes)
  - packages/backend/src/middleware/auth.ts (JWT authentication middleware)
  - packages/backend/src/routes/auth.ts (signup, login, logout endpoints)
  - packages/backend/.env.example (added JWT_SECRET)
  - PRD.md (marked task complete)
- Learnings for future iterations:
  - Auth uses JWT tokens stored in httpOnly cookies (secure, sameSite: lax)
  - Token expiration: 7 days
  - Password validation: minimum 8 characters
  - Email addresses are lowercased for consistent lookups
  - AuthRequest interface extends Express Request to add userId field
  - Import pattern: pool is exported as default from db.ts (use `import pool from '../db.js'`)
  - 401 responses for auth failures, 400 for validation errors, 500 for server errors
---